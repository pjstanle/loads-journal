using FlowFarm
const ff = FlowFarm
using DelimitedFiles
using FLOWMath
using CCBlade
using PyPlot


include("../model_lowTI_NEW.jl")

bx = boundary_vertices[:,1]
by = boundary_vertices[:,2]
append!(bx,bx[1])
append!(by,by[1])

# figure(1,figsize=(6.5,3.5))
figure(1,figsize=(6.5,2.75))

# turbine_x = readdlm("../x_FINAL2_17.txt")[:,1]
# turbine_y = readdlm("../y_FINAL2_17.txt")[:,1]
# turbine_x = readdlm("../x_FINAL2_circle_37.txt")[:,1]
# turbine_y = readdlm("../y_FINAL2_circle_37.txt")[:,1]
turbine_x = readdlm("../x_40_small_26.txt")[:,1]
turbine_y = readdlm("../y_40_small_26.txt")[:,1]
subplot(121)
grid(alpha=0.5)
plot(bx,by,"--",color="black",linewidth=0.5)
# R = 990.4415496916475
# plt.gcf().gca().add_artist(plt.Circle((0.0,0.0), R, fill=false,color="black",linestyle="--"))
for i = 1:length(turbine_x)
    plt.gcf().gca().add_artist(plt.Circle((turbine_x[i],turbine_y[i]), rotor_diameter[i]/2.0, fill=false,color="C0"))
end
title("no damage constraints",y=0.95,fontsize=10)

ylim(-500,2500)
# ylim(-R-100,R+100)
# xlim(-R-100,R+100)
axis("equal")
gca().spines["right"].set_visible(false)
gca().spines["top"].set_visible(false)
gca().spines["left"].set_visible(false)
gca().spines["bottom"].set_visible(false)
tick_params(
    which="both",      # both major and minor ticks are affected
    bottom=false,      # ticks along the bottom edge are off
    top=false,         # ticks along the top edge are off
    left=false,
    right=false,
    labelleft=false,
    labelbottom=false) # labels along the bottom edge are off

text(1500,-300,"AEP: 1129 GWh",horizontalalignment="center",fontsize=10)
# text(0.0,-R-170,"AEP: 538.8 GWh",horizontalalignment="center",fontsize=10)
#
# # turbine_x = readdlm("../with_loads/x_with_loads170.txt")[:,1]
# # turbine_y = readdlm("../with_loads/y_with_loads170.txt")[:,1]
#
# # damageOpt 40 turbs
xopt = [74.62835790467558, 96.24487360835423, 154.7390380148238, 76.940120391648, 131.9001110349114, 7.5667210651691015, 151.74988867010538, -17.85328197655721, 202.77060877173366, 40.06032358580818, 24.580669806621884, -13.394261340750733, 306.28011108954684, 281.13987710207437, -6.506282922824992, 48.88510998506487, 177.33216011729903, 234.36390715738028, 104.67425552205279, -4.842729645856914, 15.260485666866897, 177.90286509931195, 125.84327335687206, 51.66012581500048, 229.98519383201642, 252.58016081392057, 300.24154512979237, 267.5044232270395, 142.80373110066586, 254.7867708699692, 102.09290672799364, 180.0127491219712, 73.86268755539163, 228.25472935359338, 0.27618724255419136, 274.0713173326423, 277.2488586717766, 205.19959991664967, 287.3501981983801, 32.83168280268644, 137.45513420315154, 220.50686848427185, 232.24031231608717, -0.3359289502762173, 221.40099187740734, 17.429619625529398, 12.79878390786671, 218.5398584315955, 2.876443120182572, 115.52248993918344, 229.2030115975768, 109.71582615634672, 0.2837624682797359, 95.69611664336172, 164.43724734138524, 236.15805204419888, 5.933790834115881, 108.98960170090179, 196.6730290124586, 39.454240694783714, 110.02290185361244, 141.59853334245713, 18.187550731409768, -0.3193694879668013, 229.99711944470116, 218.6465542486473, 48.74710092161503, -0.33592895027621805, 38.72101090898128, 25.584498039534584, 2.1982844454135564, 232.80416442076273, 232.25938168992067, 18.456910105522955, 236.15805204419888, 180.22036512714243, 235.78739941685555, 234.97233153165521, 156.53782452488002, 16.557777378256162]
# # xopt = [322.3804884475346, 132.0302336885437, 428.9569538669368, 324.77684138152784, 187.75277030505143, 244.28446686927725, 67.48444509232638, -31.471183079273644, 423.2152596157513, -9.326301720239682, 25.415027623050296, 176.27934145785403, -7.811199776857034, 251.1019754365447, -5.3850273169076734, 235.18161116027696, 368.8875965603199, 410.3693496118587, 446.49337193066634, 166.86602859996813, 435.16280644044434, 438.9366828892884, 412.50812882853114, 46.29855083632035, 395.16774586327887, 459.6517759535896, 341.8906822852894, 451.3616624034591, -39.649342897792074, 280.53218804861467, 223.4422019530111, 258.2058042488746, 164.220723423184, -37.88662331018175, 99.7918000800026, 103.50089696101699, 329.1406290571886, -11.257141008654216, -22.763121103739486, 8.220062894651225, 245.22667613404408, 225.80260070367808, 244.87667139825757, 354.20946298342545, 199.23197798490406, 87.79149056232814, 256.3510650187224, 258.0739684809345, 298.8708161676266, 120.38930799370044, 354.20946298342545, -0.5038541436463698, 151.39687551997062, 170.1282957171277, 43.74134105198326, -0.5038541436463678, 109.03444422776211, -0.50385414364637, 107.61001793073564, 354.20946298342545, 200.43972967061094, 157.22240225775718, 354.20946298342545, 207.6110938614384, 322.85075177602505, -0.5038541436463693, 34.379155334243364, 57.635758817973034, 354.20946298342545, 354.20946298342545, 354.20946298342545, 243.23742725142102, 73.85048741443175, 310.7853826628461, -0.5038541436463697, 354.20946298342545, -0.5038541436463699, 91.98860169010662, 208.08793797432259, -0.5038541436463713]
#
# xopt = [-48.40514993336536, 91.39206067401874, 97.92872295529035, 4.171432292093477, -83.19221527825631, 22.902546522334646, -5.059135848516813, -79.97689210464576, -39.82264960489544, -97.38069832967157, -73.07254144576682, 42.45135706488485, 91.80266093339196, -94.12225867470127, 1.1703554112535066, -5.183015420939314, 66.16024368815998, 58.10142426898922, 84.32842156761181, 22.94879504202222, 86.40998842031513, 37.526378674970935, 13.106090788178044, 9.380862502290734, -53.747558694833906, 44.61182882429593, -31.475869296002717, 27.94507205979449, -89.71509208442397, -18.076070243156835, 53.09199508559883, 82.47907689490017, -27.796891317286086, 6.993053617394247, 99.03670101482327, -98.88949716154694, 73.70594827909703, -80.21202650388751, -51.94672239612879, -96.34883215049784]
#
turbine_x = xopt[1:nturbines].*10.0
turbine_y = xopt[nturbines+1:end].*10.0
#
subplot(122)
grid(alpha=0.5)
plot(bx,by,"--",color="black",linewidth=0.5)
# R = 990.4415496916475
# plt.gcf().gca().add_artist(plt.Circle((0.0,0.0), R, fill=false,color="black",linestyle="--"))
for i = 1:length(turbine_x)
    plt.gcf().gca().add_artist(plt.Circle((turbine_x[i],turbine_y[i]), rotor_diameter[i]/2.0, fill=false,color="C1"))
end
title("with damage constraints",y=0.95,fontsize=10)
#
#
ylim(-500,2500)
# ylim(-R-100,R+100)
# xlim(-R-100,R+100)
axis("equal")
gca().spines["right"].set_visible(false)
gca().spines["top"].set_visible(false)
gca().spines["left"].set_visible(false)
gca().spines["bottom"].set_visible(false)
tick_params(
    which="both",      # both major and minor ticks are affected
    bottom=false,      # ticks along the bottom edge are off
    top=false,         # ticks along the top edge are off
    left=false,
    right=false,
    labelleft=false,
    labelbottom=false) # labels along the bottom edge are off

text(1500,-300,"AEP: 1122 GWh",horizontalalignment="center",fontsize=10)

subplots_adjust(top=0.93,bottom=0.01,left=0.01,right=0.99,wspace=0.05)
#
#
# tight_layout()
#
# savefig("opt_layouts20.pdf",transparent=true)
