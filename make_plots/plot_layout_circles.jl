using FlowFarm
const ff = FlowFarm
using DelimitedFiles
using FLOWMath
using CCBlade
using PyPlot


include("../model_lowTI_NEW.jl")

bx = boundary_vertices[:,1]
by = boundary_vertices[:,2]
append!(bx,bx[1])
append!(by,by[1])

# figure(1,figsize=(6.5,3.5))
figure(1,figsize=(3.0,2.5))
#
# xopt = [74.62835790467558, 96.24487360835423, 154.7390380148238, 76.940120391648, 131.9001110349114, 7.5667210651691015, 151.74988867010538, -17.85328197655721, 202.77060877173366, 40.06032358580818, 24.580669806621884, -13.394261340750733, 306.28011108954684, 281.13987710207437, -6.506282922824992, 48.88510998506487, 177.33216011729903, 234.36390715738028, 104.67425552205279, -4.842729645856914, 15.260485666866897, 177.90286509931195, 125.84327335687206, 51.66012581500048, 229.98519383201642, 252.58016081392057, 300.24154512979237, 267.5044232270395, 142.80373110066586, 254.7867708699692, 102.09290672799364, 180.0127491219712, 73.86268755539163, 228.25472935359338, 0.27618724255419136, 274.0713173326423, 277.2488586717766, 205.19959991664967, 287.3501981983801, 32.83168280268644, 137.45513420315154, 220.50686848427185, 232.24031231608717, -0.3359289502762173, 221.40099187740734, 17.429619625529398, 12.79878390786671, 218.5398584315955, 2.876443120182572, 115.52248993918344, 229.2030115975768, 109.71582615634672, 0.2837624682797359, 95.69611664336172, 164.43724734138524, 236.15805204419888, 5.933790834115881, 108.98960170090179, 196.6730290124586, 39.454240694783714, 110.02290185361244, 141.59853334245713, 18.187550731409768, -0.3193694879668013, 229.99711944470116, 218.6465542486473, 48.74710092161503, -0.33592895027621805, 38.72101090898128, 25.584498039534584, 2.1982844454135564, 232.80416442076273, 232.25938168992067, 18.456910105522955, 236.15805204419888, 180.22036512714243, 235.78739941685555, 234.97233153165521, 156.53782452488002, 16.557777378256162]

# revised draft
xopt = [53.29648756898605, 77.9175886330757, 148.07528986934037, 83.17418393804026, 120.51770219663752, 21.005416324829095, 155.66918272054508, -27.672220403864674, 200.81151539272574, 38.5367862353218, 20.825498281186423, 20.926582812145032, 289.8957699196789, 289.7641640895101, -10.039061285390511, 39.58849056322875, 177.94989961299535, 232.32606772393797, 97.85089718574444, -1.4202350977256368, 10.312765761954497, 157.33990600681003, 130.19227517696737, 59.32610168357715, 222.21867967769222, 247.58475687666075, 270.1805625836482, 265.9471499957479, 150.22021452200212, 256.21911693660127, 107.70759499339682, 173.39282885084765, 96.24477097078487, 234.16624526679192, -3.0900466848395656, 265.6493919710731, 276.4244800447038, 200.9564058802872, 285.5103075648353, 43.28387093551336, 169.69877312361527, 175.43286265802772, 236.08680580278988, 6.1596324189114275, 229.09050868004877, -0.33592895027621716, 11.607607564647457, 227.028338900565, 10.45974840123658, 124.5707597494563, 224.81522197709415, 58.14360587633082, 7.759872665255181, 127.42015470638279, 123.22870022116903, 200.2062457532812, -0.33592895027621694, 129.28281011548597, 155.10487227561782, 11.333200178420235, 108.23264915763669, 164.77215690408133, 23.813309136520388, 14.54696665882602, 221.83563833746646, 211.6797701542067, 98.48536585463481, -0.3359289502762171, 39.23926369919158, 23.666944491084994, 12.258329383959625, 235.37908905742128, 236.1547340454255, 11.307767677365936, 233.0082163658532, 187.65561921410324, 236.1569204016498, 207.87038890612516, 171.78070595656752, 41.752936167417666]

turbine_x = xopt[1:nturbines].*10.0
turbine_y = xopt[nturbines+1:end].*10.0

grid(alpha=0.5)
plot(bx,by,"--",color="black",linewidth=0.5)
for i = 1:length(turbine_x)
    if i == 21
        plt.gcf().gca().add_artist(plt.Circle((turbine_x[i],turbine_y[i]), rotor_diameter[i]/2.0, fill=false,color="C1"))
    else
        plt.gcf().gca().add_artist(plt.Circle((turbine_x[i],turbine_y[i]), rotor_diameter[i]/2.0, fill=false,color="C1"))
    end
end
plt.gcf().gca().add_artist(plt.Circle((488,294), 300.0, fill=false,color="black"))
plt.gcf().gca().add_artist(plt.Circle((440,1850), 300.0, fill=false,color="black"))
plt.gcf().gca().add_artist(plt.Circle((1470,257), 300.0, fill=false,color="black"))
# plt.gcf().gca().add_artist(plt.Circle((2820,1668), 300.0, fill=false,color="black"))
plt.gcf().gca().add_artist(plt.Circle((2613,130), 300.0, fill=false,color="black"))
ylim(-500,2500)
axis("equal")
gca().spines["right"].set_visible(false)
gca().spines["top"].set_visible(false)
gca().spines["left"].set_visible(false)
gca().spines["bottom"].set_visible(false)
tick_params(
    which="both",      # both major and minor ticks are affected
    bottom=false,      # ticks along the bottom edge are off
    top=false,         # ticks along the top edge are off
    left=false,
    right=false,
    labelleft=false,
    labelbottom=false) # labels along the bottom edge are off

savefig("opt_layouts_circles2.pdf",transparent=true)
