using FlowFarm
using PyPlot
const ff = FlowFarm
include("../model.jl")

sep_arr = [4.0,7.0,10.0]
# sep_arr = [-2.0]

figure(1,figsize=[6.0,2.5])
for k = 1:3
sep = sep_arr[k]

    TI_free = 0.08
    ws = 13
    ti = "high"
    x = rotor_diameter[1]*sep
    # x_vec = range(turbine_x[1],stop = turbine_x[1]+10.0*rotor_diameter[1],length=100)
    y_vec = range(-1.5*rotor_diameter[1],stop = 1.5*rotor_diameter[1],length=100)
    # z_vec = range(0.0,stop = 2.0*rotor_diameter[1],length=100)
    z = hub_height[1]
    TI = zeros(length(y_vec))

    for i = 1:length(TI)
               loc = [x,y_vec[i],z]
               TI[i] = ff.GaussianTI(loc,turbine_x, turbine_y, rotor_diameter, hub_height, turbine_ct, sorted_turbine_index, TI_free; div_sigma=2.0, div_ti=2.0)
    end

    ti4 = [0.06812917, 0.07215114, 0.07207479, 0.07386258, 0.07115753,
       0.07945391, 0.08106607, 0.08382061, 0.08279374, 0.09021498,
       0.091866  , 0.09425444, 0.09140604, 0.09790647, 0.09884187,
       0.10043217, 0.09709545, 0.10315002, 0.10195095, 0.1012717 ,
       0.09484126, 0.09443121, 0.09327964, 0.09290604, 0.09103683,
       0.09438893, 0.09244794, 0.09117052, 0.0858452 , 0.08640758,
       0.08453177, 0.08380009, 0.07958684, 0.08121586, 0.08173884,
       0.08356421, 0.08101907, 0.0871498 , 0.08858318, 0.09073392,
       0.0863518 , 0.09194484, 0.09321143, 0.09498789, 0.09283865,
       0.09683936, 0.09528471, 0.09461379, 0.08921273, 0.09054033,
       0.0892363 , 0.08879812, 0.08233528, 0.08472763, 0.08336461,
       0.08244902, 0.07384602, 0.07873486, 0.07963536, 0.08178664,
       0.07855533, 0.08926511, 0.09063964, 0.09280273, 0.08619319,
       0.08917601, 0.08933596, 0.09037446, 0.08701953, 0.09493576,
       0.09455668, 0.09489132, 0.08534718, 0.08845427, 0.08466641,
       0.0813198 , 0.07190555, 0.07178862, 0.07055257, 0.07083756,
       0.07151424, 0.08369215, 0.08715807, 0.09127681, 0.08579307,
       0.09002241, 0.08965996, 0.08999404, 0.08836348, 0.09122077,
       0.09213425, 0.09400137, 0.09555375, 0.10216079, 0.10337508,
       0.10500629, 0.10161799, 0.10615496, 0.10506941, 0.10463094,
       0.09897747, 0.10207382, 0.10047219, 0.0996715 , 0.09277346,
       0.09690892, 0.09588509, 0.09601807, 0.09011887, 0.09643175,
       0.09651711, 0.09779195, 0.09165388, 0.09416605, 0.09334379,
       0.09392972, 0.0917192 , 0.0962582 , 0.09666237, 0.09825441,
       0.09530899, 0.10048865, 0.09985095, 0.10048325, 0.09374703,
       0.0956226 , 0.09216883, 0.09117254, 0.08614743, 0.09191561,
       0.09348789, 0.09744636, 0.09336514, 0.10047599, 0.10090189,
       0.10227741, 0.09405228, 0.09958051, 0.09740475, 0.09659198,
       0.08941205, 0.09686129, 0.09698053, 0.09842562, 0.09139286,
       0.09921612, 0.09951083, 0.10123645, 0.09327397, 0.10301343,
       0.10448074, 0.10692911, 0.09785432, 0.10645454, 0.10508467,
       0.10452611, 0.09330954, 0.09806148, 0.09445793, 0.0926357 ,
       0.082658  ]
    ti7 = [0.0718752 , 0.07605935, 0.07903137, 0.08425509, 0.08523432,
       0.09173769, 0.0929884 , 0.09550195, 0.0915763 , 0.09563637,
       0.0968232 , 0.0992704 , 0.09789003, 0.10450426, 0.10577061,
       0.10787826, 0.10372135, 0.1083526 , 0.10712485, 0.10669976,
       0.099892  , 0.10187568, 0.10017402, 0.09926447, 0.09526139,
       0.09646716, 0.09437947, 0.0934859 , 0.08992656, 0.0904247 ,
       0.08911598, 0.08885179, 0.08617227, 0.08607964, 0.08490975,
       0.08458165, 0.08204835, 0.08157289, 0.08102966, 0.08132176,
       0.08073104, 0.08240667, 0.08274104, 0.08362889, 0.08376091,
       0.0872594 , 0.08737024, 0.08819592, 0.0866415 , 0.0908373 ,
       0.09019124, 0.0902    , 0.08646836, 0.08982207, 0.08788266,
       0.08708269, 0.08183826, 0.0842086 , 0.08453638, 0.0863629 ,
       0.08662118, 0.0936903 , 0.09447856, 0.09619638, 0.09277662,
       0.0977064 , 0.09563281, 0.09451539, 0.08880431, 0.09174401,
       0.08991513, 0.08933295, 0.08454727, 0.08864017, 0.0878196 ,
       0.08856316, 0.0816693 , 0.08590979, 0.08417882, 0.08356144,
       0.07666194, 0.08079116, 0.07893467, 0.07834107, 0.07170572,
       0.07567685, 0.07507084, 0.07591219, 0.07141457, 0.07864606,
       0.08169872, 0.08598178, 0.08470331, 0.09343859, 0.09658139,
       0.10078928, 0.09963452, 0.10813168, 0.1083873 , 0.10954376,
       0.10359095, 0.11167753, 0.10849721, 0.10619036, 0.09612954,
       0.09846186, 0.09629652, 0.09518775, 0.09015605, 0.09188479,
       0.09087198, 0.09053406, 0.08702445, 0.08788776, 0.08742969,
       0.08800155, 0.08552333, 0.08634143, 0.0863686 , 0.08747366,
       0.08567099, 0.087213  , 0.0861009 , 0.08681319, 0.08331196,
       0.08696167, 0.08741502, 0.08937391, 0.08627789, 0.09395788,
       0.09346624, 0.09419716, 0.08762306, 0.09274461, 0.0921245 ,
       0.09301787, 0.08873858, 0.09562181, 0.09659549, 0.09907542,
       0.09375544, 0.100197  , 0.10014224, 0.10099138, 0.09499869,
       0.09792728, 0.09746952, 0.09829403, 0.09720991, 0.10583079,
       0.10475488, 0.10545105, 0.10031647, 0.10831423, 0.10638856,
       0.10658632, 0.10006509, 0.10699689, 0.10431283, 0.10358707,
       0.09272626]
    ti10 = [0.08354043, 0.08150822, 0.08099294, 0.08202012, 0.0843955 ,
       0.08190638, 0.08052216, 0.08030133, 0.08061951, 0.07699481,
       0.07451061, 0.07327728, 0.07522584, 0.07526352, 0.07665445,
       0.07930396, 0.08257395, 0.08294888, 0.0843489 , 0.08671651,
       0.08812405, 0.08587817, 0.08434353, 0.08355076, 0.08125358,
       0.08024367, 0.08010849, 0.08084276, 0.08185263, 0.08130586,
       0.08159948, 0.08272841, 0.084102  , 0.08330536, 0.08309473,
       0.08347138, 0.08367465, 0.08212461, 0.08115795, 0.08079089,
       0.08201964, 0.08053699, 0.07980731, 0.07985159, 0.08071797,
       0.07961667, 0.07940369, 0.08009254, 0.08056578, 0.07780275,
       0.07590716, 0.07496275, 0.07447076, 0.07207547, 0.07065091,
       0.0702808 , 0.0694663 , 0.06868915, 0.06897459, 0.07033113,
       0.0712052 , 0.07085358, 0.07169362, 0.07371032, 0.07636173,
       0.07445635, 0.07341   , 0.07328832, 0.07539754, 0.07535255,
       0.07657161, 0.07901339, 0.0819889 , 0.08166881, 0.08250238,
       0.08446524, 0.08534998, 0.0835513 , 0.08303228, 0.08382415,
       0.08566577, 0.08248957, 0.08073382, 0.08050391, 0.08132246,
       0.08144522, 0.08332154, 0.08686671, 0.09018234, 0.089402  ,
       0.08969182, 0.09104693, 0.09412057, 0.09090102, 0.08901908,
       0.08853388, 0.09083311, 0.09056124, 0.09125492, 0.09287911,
       0.09413709, 0.09304273, 0.09279026, 0.09338446, 0.093926  ,
       0.09309544, 0.09367291, 0.09564137, 0.09870762, 0.09838332,
       0.09921498, 0.10117926, 0.10373023, 0.09979151, 0.09682968,
       0.09491618, 0.09341681, 0.09033694, 0.08860354, 0.08829003,
       0.0880281 , 0.08750786, 0.08828258, 0.09034088, 0.0936685 ,
       0.09394034, 0.09565538, 0.09875216, 0.10280902, 0.10214879,
       0.10246753, 0.10375354, 0.10226028, 0.10107875, 0.10104893,
       0.10216832, 0.10117469, 0.09657084, 0.09327225, 0.09143008,
       0.09169602, 0.08647002, 0.08305315, 0.08167173, 0.08119699,
       0.07790063, 0.07608727, 0.07585331, 0.07612464, 0.07329624,
       0.07199271, 0.07229936, 0.07349645, 0.06988133, 0.06747492,
       0.06642364, 0.06663236, 0.06484167, 0.06481027, 0.06656944,
       0.06817795]

    if k == 1
        subplot(131)
    elseif k == 2
        subplot(132)
    elseif k == 3
        subplot(133)
    end


    x_TI = range(-200.0/rotor_diameter[1],stop=200.0/rotor_diameter[1],length=length(ti4))
    if sep == 4.0
           plot(x_TI,ti4)
           title("4 D",fontsize=10)
           ylabel("TI")
    elseif sep == 7.0
           plot(x_TI,ti7)
           title("7 D",fontsize=10)

           tick_params(
               axis="y",          # changes apply to the x-axis
               which="both",      # both major and minor ticks are affected
               left=false,      # ticks along the bottom edge are off
               top=false,         # ticks along the top edge are off
               labelleft=false) # labels along the bottom edge are off

    elseif sep == 10.0
           plot(x_TI,ti10,label="SOWFA")
           title("10 D",fontsize=10)

           tick_params(
               axis="y",          # changes apply to the x-axis
               which="both",      # both major and minor ticks are affected
               left=false,      # ticks along the bottom edge are off
               top=false,         # ticks along the top edge are off
               labelleft=false) # labels along the bottom edge are off

    end

    if k == 3
        plot(y_vec./rotor_diameter[1],TI,label="TI model")
        legend(loc=1)
    else
        plot(y_vec./rotor_diameter[1],TI)
    end

    ylim(0.0,0.225)
    xlabel("offset (D)")

end

subplots_adjust(top=0.91,bottom=0.18,left=0.11,right=0.99,wspace=0.05)
# savefig("turbulence_profiles.pdf",transparent=true)
